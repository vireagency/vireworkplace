import{r as t,n as L,p as S,o as A,t as g,j as e,S as R,L as B}from"./index-DSewVFua.js";import{C as E,a as M,c as V,d as F,e as D,B as p}from"./card-EJ5g6USJ.js";import{L as $,I as z}from"./label-BahFRQBq.js";import{R as I}from"./refresh-cw-dVySPRP4.js";import{A as q}from"./arrow-left-Cfpt0CiH.js";import"./index-C13qTn-R.js";function W(){const[o,v]=t.useState(""),[n,m]=t.useState(!1),[f,r]=t.useState(""),[i,y]=t.useState(0),c=L(),x=S(),{secureAxios:d}=A(),h=t.useCallback(s=>s&&s.length===6&&/^\d{6}$/.test(s),[]);t.useEffect(()=>{if(i>0){const s=setTimeout(()=>y(i-1),1e3);return()=>clearTimeout(s)}},[i]);const w=t.useCallback(async s=>{if(s.preventDefault(),!h(o)){r("Please enter a valid 6-digit OTP");return}try{m(!0),r("");const{mode:a,email:l,forgotPasswordToken:b,tempToken:k}=x.state||{};let u;a==="forgot-password"?u=await d.post("/auth/forgot-password/verify-otp",{otp:o.trim(),email:l},{headers:{Authorization:`Bearer ${b}`}}):u=await d.post("/auth/otp/verify-account",{otp:o.trim()},{headers:{Authorization:`Bearer ${k}`}}),u.data.success?a==="forgot-password"?(g.success("OTP verified successfully! Please set your new password."),c("/password-reset",{state:{email:l,resetToken:u.data.token||b}})):(g.success("Account verified successfully! Please sign in."),c("/login")):r(u.data.message||"OTP verification failed")}catch(a){console.error("OTP verification error:",a);const l=a.response?.data?.message||a.message||"OTP verification failed. Please try again.";r(l)}finally{m(!1)}},[o,h,d,c,x.state]),j=t.useCallback(async()=>{try{m(!0),r("");const{email:s,mode:a}=x.state||{},l=await d.post("/auth/otp/resend",{email:s});l.data.success?(g.success("OTP has been resent to your email!"),y(60)):r(l.data.message||"Failed to resend OTP")}catch(s){console.error("OTP resend error:",s);const a=s.response?.data?.message||s.message||"Failed to resend OTP. Please try again.";r(a)}finally{m(!1)}},[d,x.state]),T=t.useCallback(()=>{c("/login")},[c]),P=t.useCallback(s=>{const a=s.target.value.replace(/\D/g,"").slice(0,6);v(a),f&&r("")},[f]),C=t.useMemo(()=>h(o),[o,h]),N=t.useMemo(()=>n?"Verifying...":"Verify OTP",[n]),O=t.useMemo(()=>i===0,[i]);return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4",children:e.jsxs(E,{className:"w-full max-w-md shadow-xl",children:[e.jsxs(M,{className:"text-center space-y-2",children:[e.jsx("div",{className:"mx-auto w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(R,{className:"w-6 h-6 text-blue-600"})}),e.jsx(V,{className:"text-2xl font-bold text-gray-900",children:"Verify OTP"}),e.jsx(F,{className:"text-gray-600",children:"Enter the 6-digit verification code sent to your email."})]}),e.jsx(D,{children:e.jsxs("form",{onSubmit:w,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{htmlFor:"otp",className:"text-sm font-medium text-gray-700",children:"Verification Code"}),e.jsx(z,{id:"otp",type:"text",placeholder:"Enter 6-digit OTP",value:o,onChange:P,className:"w-full text-center text-lg tracking-widest",disabled:n,maxLength:6,required:!0})]}),f&&e.jsx("div",{className:"text-sm text-red-600 bg-red-50 p-3 rounded-md",children:f}),e.jsxs(p,{type:"submit",className:"w-full bg-blue-600 hover:bg-blue-700 text-white",disabled:!C||n,children:[n&&e.jsx(B,{className:"w-4 h-4 mr-2 animate-spin"}),N]}),e.jsxs("div",{className:"text-center space-y-2",children:[e.jsxs(p,{type:"button",variant:"ghost",onClick:j,className:"text-blue-600 hover:text-blue-700",disabled:n||!O,children:[e.jsx(I,{className:"w-4 h-4 mr-2"}),"Resend OTP"]}),i>0&&e.jsxs("div",{className:"text-sm text-gray-500",children:["Resend available in ",i," seconds"]})]}),e.jsxs(p,{type:"button",variant:"ghost",onClick:T,className:"w-full text-gray-600 hover:text-gray-800",disabled:n,children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"Back to Login"]})]})})]})})}export{W as default};
